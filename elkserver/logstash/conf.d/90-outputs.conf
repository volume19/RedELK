# RedELK Output Configuration
# Routes processed logs to appropriate Elasticsearch indices

output {
  # Redirector traffic goes to redirtraffic index
  if [infra.log_type] == "redirtraffic" {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "redirtraffic-%{+YYYY.MM.dd}"
      template_name => "redirtraffic"
      template => "/usr/share/logstash/config/templates/redirtraffic.json"
      template_overwrite => true
    }
  }

  # C2 operations go to rtops index
  else if [infra.log_type] == "rtops" {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "rtops-%{+YYYY.MM.dd}"
      template_name => "rtops"
      template => "/usr/share/logstash/config/templates/rtops.json"
      template_overwrite => true
    }
  }

  # Credentials go to credentials index
  else if "credentials" in [tags] {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "credentials-%{+YYYY.MM.dd}"
      template_name => "credentials"
      template => "/usr/share/logstash/config/templates/credentials.json"
      template_overwrite => true
    }
  }

  # IOCs go to ioc index
  else if "ioc" in [tags] {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "ioc-%{+YYYY.MM.dd}"
      template_name => "ioc"
      template => "/usr/share/logstash/config/templates/ioc.json"
      template_overwrite => true
    }
  }

  # Screenshots metadata
  else if "screenshot" in [tags] {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "screenshots-%{+YYYY.MM.dd}"
      template_name => "screenshots"
    }
  }

  # Default fallback to redelk index
  else {
    elasticsearch {
      hosts => ["http://elasticsearch:9200"]
      user => "logstash_system"
      password => "${ELASTIC_PASSWORD}"
      index => "redelk-%{+YYYY.MM.dd}"
      template_name => "redelk"
      template_overwrite => true
    }
  }

  # Debug output (disable in production)
  # stdout { codec => rubydebug }
}