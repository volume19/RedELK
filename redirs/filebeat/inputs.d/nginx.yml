# RedELK Nginx Redirector Input Configuration
#
# This file configures Filebeat to read Nginx redirector logs
# Place in /etc/filebeat/inputs.d/ on Nginx redirectors
#

- type: log
  enabled: true

  # Path to Nginx RedELK log file
  paths:
    - /var/log/nginx/access-redelk.log

  # Prevent duplicate processing
  scan_frequency: 5s
  harvester_buffer_size: 16384
  max_bytes: 10485760

  # Add fields to identify this redirector
  fields_under_root: true
  fields:
    infra:
      attack_scenario: ${ATTACKSCENARIO}
      log:
        type: redirtraffic
    redir:
      program: nginx
      frontend:
        name: ${FRONTEND:www}
      backend:
        name: ${BACKEND:c2-https}

  # Nginx logs are single line by default
  multiline.pattern: '^\d{2}/[A-Za-z]{3}/\d{4}'
  multiline.negate: true
  multiline.match: after

  # Exclude certain lines
  exclude_lines: ['^#', '^$']

  # Close file handlers
  close_inactive: 5m
  close_renamed: false
  close_removed: true
  close_eof: false

  # Clean registry
  clean_removed: true

  # Backoff settings
  backoff: 1s
  max_backoff: 10s