# RedELK Apache Redirector Input Configuration
#
# This file configures Filebeat to read Apache redirector logs
# Place in /etc/filebeat/inputs.d/ on Apache redirectors
#

- type: log
  enabled: true

  # Path to Apache RedELK log file
  paths:
    - /var/log/apache2/access-redelk.log

  # Prevent duplicate processing
  scan_frequency: 5s
  harvester_buffer_size: 16384
  max_bytes: 10485760

  # Add fields to identify this redirector
  fields_under_root: true
  fields:
    infra:
      attack_scenario: ${ATTACKSCENARIO}
      log:
        type: redirtraffic
    redir:
      program: apache
      frontend:
        name: ${FRONTEND:www}
      backend:
        name: ${BACKEND:c2-https}

  # Multiline configuration (if needed for error logs)
  multiline.pattern: '^\['
  multiline.negate: true
  multiline.match: after

  # Exclude certain lines (optional)
  exclude_lines: ['^#', '^$']

  # Close file handlers
  close_inactive: 5m
  close_renamed: false
  close_removed: true
  close_eof: false

  # Clean registry
  clean_removed: true

  # Backoff settings for slow files
  backoff: 1s
  max_backoff: 10s